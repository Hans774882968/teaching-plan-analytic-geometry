# 闯关功能测试用例

## 提示词

大佬，请读取当前所有有改动的除测试以外的文件，并编写一个详尽的人工测试用例文档，放在 docs\闯关功能开发 文件夹下

## 功能概述

本次开发的闯关功能新增了以下特性：
1. **计时模式**：在关卡中显示实时计时器
2. **打乱题目**：随机打乱关卡题目顺序
3. **速通纪录**：记录同时开启计时和打乱题目且全部答对的最短耗时
4. **答题统计**：显示答对题数和正确率

## 测试环境准备

### 前置条件
- 项目已启动并运行在本地开发环境
- 浏览器：Chrome、Firefox、Safari、Edge 等现代浏览器
- 确保音频功能正常（可选，用于音效测试）

### 测试数据
- 准备至少2-3个不同的关卡用于测试
- 每个关卡有不同数量的题目（建议3-10题）
- 题目类型包括填空题和选择题

## LevelCard.jsx 组件测试

### TC-LC-001: 基础显示测试
**测试目的**：验证关卡卡片的基础显示功能

**测试步骤**：
1. 访问闯关页面 `/math-challenges`
2. 观察关卡卡片的显示

**预期结果**：
- 卡片显示关卡标题、图标、题目数量
- 显示完成进度条和完成状态
- 显示速通纪录（如果有）
- 底部有"开始"按钮

### TC-LC-002: 开关功能测试
**测试目的**：验证计时模式和打乱题目开关功能

**测试步骤**：
1. 在关卡卡片中找到"计时模式"开关
2. 点击开关切换状态
3. 在关卡卡片中找到"打乱题目"开关
4. 点击开关切换状态

**预期结果**：
- 开关可以正常切换开启/关闭状态
- 开关视觉状态正确反映当前状态
- 开关切换流畅，无卡顿

### TC-LC-003: URL参数构建测试
**测试目的**：验证开关状态正确传递到URL参数

**测试步骤**：
1. 只开启"计时模式"开关
2. 点击"开始"按钮
3. 观察跳转后的URL
4. 返回，只开启"打乱题目"开关
5. 点击"开始"按钮
6. 观察跳转后的URL
7. 返回，同时开启两个开关
8. 点击"开始"按钮
9. 观察跳转后的URL
10. 返回，关闭所有开关
11. 点击"开始"按钮
12. 观察跳转后的URL

**预期结果**：
- 只开启计时：URL包含 `?timer=true`
- 只开启打乱：URL包含 `?shuffle=true`
- 同时开启：URL包含 `?timer=true&shuffle=true`
- 都关闭：URL不包含查询参数

### TC-LC-004: 速通纪录显示测试
**测试目的**：验证速通纪录的正确显示

**测试步骤**：
1. 观察已有速通纪录的关卡卡片
2. 观察没有速通纪录的关卡卡片

**预期结果**：
- 有纪录：显示"速通纪录：MM:SS"格式
- 无纪录：显示"速通纪录：--:--"

## Challenge.jsx 组件测试

### TC-C-001: 参数读取测试
**测试目的**：验证URL查询参数的正确读取

**测试步骤**：
1. 直接访问 `/math-challenge/[关卡名]?timer=true`
2. 验证计时器是否显示
3. 直接访问 `/math-challenge/[关卡名]?shuffle=true`
4. 验证打乱模式标签是否显示
5. 直接访问 `/math-challenge/[关卡名]?timer=true&shuffle=true`
6. 验证两个功能是否都启用
7. 直接访问 `/math-challenge/[关卡名]`（无参数）
8. 验证两个功能都未启用

**预期结果**：
- 参数正确读取并启用对应功能
- 标签正确显示当前启用的模式

### TC-C-002: 计时器功能测试
**测试目的**：验证计时器的准确性

**测试步骤**：
1. 启用计时模式进入关卡
2. 观察计时器初始状态
3. 等待1分钟，观察计时器显示
4. 完成几道题目，观察计时器是否继续运行
5. 切换到下一题，观察计时器是否继续运行

**预期结果**：
- 计时器从00:00开始
- 每秒正常递增
- 格式为MM:SS
- 在答题过程中持续运行

### TC-C-003: 打乱题目功能测试
**测试目的**：验证题目打乱功能

**测试步骤**：
1. 不启用打乱模式，记录题目顺序
2. 完成关卡或退出
3. 启用打乱模式再次进入同一关卡
4. 对比题目顺序是否改变
5. 重复3-4次，验证每次顺序都不同

**预期结果**：
- 未启用：题目按原始顺序显示
- 启用：题目顺序随机打乱
- 每次进入顺序都不同

### TC-C-004: 标签显示测试
**测试目的**：验证模式标签的正确显示

**测试步骤**：
1. 测试各种参数组合下的标签显示：
   - 无参数：无标签
   - 只有timer：显示"计时模式"标签
   - 只有shuffle：显示"打乱模式"标签
   - 两个都有：显示两个标签

**预期结果**：
- 标签颜色和样式符合设计规范
- 标签文字清晰可读
- 标签位置合理，不影响其他元素

### TC-C-005: 加载状态测试
**测试目的**：验证打乱模式下的加载状态

**测试步骤**：
1. 启用打乱模式进入关卡
2. 观察初始加载状态

**预期结果**：
- 显示"加载中..."提示
- 加载完成后正常显示题目内容

## LevelComplete.jsx 组件测试

### TC-LC-001: 基础信息显示测试
**测试目的**：验证完成页面的基础信息显示

**测试步骤**：
1. 完成一个关卡（不启用特殊功能）
2. 观察完成页面显示

**预期结果**：
- 显示积分奖励
- 显示当前总积分
- 显示答对题数：正确题数/总题数
- 显示正确率百分比
- 显示通关状态

### TC-LC-002: 计时信息显示测试
**测试目的**：验证计时信息的正确显示

**测试步骤**：
1. 启用计时模式完成关卡
2. 观察完成页面的计时信息

**预期结果**：
- 显示"用时：MM:SS"
- 时间与实际用时一致
- 时间显示位置合理

### TC-LC-003: 速通纪录功能测试
**测试目的**：验证速通纪录的更新和显示

**测试步骤**：
1. 同时启用计时和打乱模式
2. 全部答对完成关卡
3. 记录完成时间
4. 再次以同样模式完成，但用时更长
5. 观察纪录是否更新
6. 再次完成，用时更短
7. 观察纪录是否更新和新纪录提示

**预期结果**：
- 首次完成：建立初始纪录
- 用时更长：纪录不更新
- 用时更短：纪录更新，显示新纪录动画
- 只有全部答对才更新纪录

### TC-LC-004: 部分答对测试
**测试目的**：验证部分答对时的行为

**测试步骤**：
1. 同时启用计时和打乱模式
2. 部分答对（不是全部）完成关卡
3. 观察是否更新纪录

**预期结果**：
- 显示实际答题统计
- 不更新速通纪录
- 不显示新纪录提示

## mathChallengesState.js 状态管理测试

### TC-MS-001: 数据持久化测试
**测试目的**：验证数据的本地存储持久化

**测试步骤**：
1. 完成一些题目，获得积分
2. 刷新页面
3. 观察积分和完成状态是否保持
4. 建立一个速通纪录
5. 刷新页面
6. 观察纪录是否保持

**预期结果**：
- 积分和完成状态正确保持
- 速通纪录正确保持
- 数据不会丢失

### TC-MS-002: 纪录更新逻辑测试
**测试目的**：验证速通纪录的更新逻辑

**测试步骤**：
1. 测试不同场景下的纪录更新：
   - 只有计时模式，全部答对
   - 只有打乱模式，全部答对
   - 两个模式都有，部分答对
   - 两个模式都有，全部答对，用时更长
   - 两个模式都有，全部答对，用时更短

**预期结果**：
- 只有同时满足两个条件且全部答对才更新纪录
- 只有比现有纪录更短才更新
- 其他情况不更新纪录

## utils.js 工具函数测试

### TC-U-001: getTimerText 函数测试
**测试目的**：验证时间格式化函数的正确性

**测试步骤**：
1. 测试各种输入值：
   - 0秒
   - 59秒
   - 60秒
   - 3599秒
   - 3600秒
   - 86400秒
   - 负值
   - null
   - undefined
   - 非数字

**预期结果**：
- 0秒 → "00:00"
- 59秒 → "00:59"
- 60秒 → "01:00"
- 3599秒 → "59:59"
- 3600秒 → "01:00:00"
- 86400秒 → "24:00:00"
- 负值 → "00:00"
- null/undefined → ""
- 非数字 → 抛出TypeError

## 边界条件和异常测试

### TC-B-001: 空关卡测试
**测试目的**：测试没有题目的关卡

**测试步骤**：
1. 创建一个没有题目的测试关卡
2. 尝试进入该关卡

**预期结果**：
- 系统正常处理
- 不会崩溃或报错
- 显示合适的提示信息

### TC-B-002: 单题目关卡测试
**测试目的**：测试只有一个题目的关卡

**测试步骤**：
1. 创建一个只有一个题目的关卡
2. 完成该题目
3. 观察完成页面

**预期结果**：
- 正常显示进度
- 正确计算正确率
- 正确处理完成逻辑

### TC-B-003: 浏览器兼容性测试
**测试目的**：测试不同浏览器下的功能

**测试步骤**：
1. 在不同浏览器中测试所有功能
2. Chrome、Firefox、Safari、Edge
3. 移动端浏览器

**预期结果**：
- 所有功能在各浏览器中正常工作
- 样式显示一致
- 性能表现良好

### TC-B-004: 网络环境测试
**测试目的**：测试不同网络环境下的表现

**测试步骤**：
1. 在正常网络环境下测试
2. 在慢速网络环境下测试
3. 在离线环境下测试

**预期结果**：
- 核心功能在离线环境下正常工作
- 慢速网络下加载时间可接受
- 不会出现网络相关错误

## 性能测试

### TC-P-001: 大量题目测试
**测试目的**：测试关卡包含大量题目时的性能

**测试步骤**：
1. 创建一个包含50+题目的关卡
2. 启用打乱模式
3. 观察加载时间和运行性能

**预期结果**：
- 打乱算法在合理时间内完成
- 页面响应流畅
- 不会出现内存泄漏

### TC-P-002: 长时间计时测试
**测试目的**：测试长时间计时的准确性

**测试步骤**：
1. 启用计时模式
2. 让页面运行1小时以上
3. 观察计时器的准确性

**预期结果**：
- 计时器保持准确
- 不会出现时间漂移
- 内存使用稳定

## 用户体验测试

### TC-UX-001: 交互流畅性测试
**测试目的**：验证用户交互的流畅性

**测试步骤**：
1. 测试各种用户操作：
   - 快速切换开关状态
   - 快速点击按钮
   - 快速输入答案
   - 快速切换题目

**预期结果**：
- 所有交互响应迅速
- 不会出现卡顿或延迟
- 界面状态同步正确

### TC-UX-002: 视觉反馈测试
**测试目的**：验证视觉反馈的及时性

**测试步骤**：
1. 测试各种视觉反馈：
   - 开关切换动画
   - 按钮点击效果
   - 新纪录动画
   - 进度条更新

**预期结果**：
- 动画流畅自然
- 反馈及时明确
- 视觉效果协调

## 测试通过标准

### 必须通过的测试
- 所有TC-LC、TC-C、TC-LC、TC-MS系列测试
- 基础功能测试（TC-B-001, TC-B-002）
- 工具函数测试（TC-U-001）

### 建议通过的测试
- 边界条件测试（TC-B-003, TC-B-004）
- 性能测试（TC-P-001, TC-P-002）
- 用户体验测试（TC-UX-001, TC-UX-002）

### 测试报告模板
```
测试环境：[浏览器版本+操作系统]
测试时间：[YYYY-MM-DD HH:MM]
测试人员：[姓名]

测试结果总结：
- 通过：[数量]个
- 失败：[数量]个
- 阻塞：[数量]个

问题描述：
1. [测试ID] - [问题描述]
   复现步骤：[详细步骤]
   期望结果：[期望结果]
   实际结果：[实际结果]
   
建议改进：
1. [改进建议]
```

## 回归测试

### 关键功能回归点
1. 原有的积分系统
2. 原有的答题功能
3. 原有的进度条
4. 原有的音效系统
5. 原有的学习伙伴系统

### 回归测试步骤
1. 完整体验不启用新功能的闯关流程
2. 验证所有原有功能正常工作
3. 验证新旧功能之间没有冲突

---

- **文档版本**：v1.0
- **创建日期**：2025-09-17
- **最后更新**：2025-09-17
- **文档状态**：初稿
